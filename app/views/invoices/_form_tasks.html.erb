<div x-data="{ add_tasks: false }">
  <% if tasks.any? %>
    <button @click="add_tasks = true" class="btn btn-orange">
      Add tasks
    </button>
  <% else %>
    <button disabled class="btn normal-case bg-gray-400 cursor-not-allowed">
      No more tasks
    </button>
  <% end %>
  <div id="invoice-tasks" x-show="add_tasks" class="overflow-y-auto bg-gray-900 px-8" style="background-color: rgba(0,0,0,0.3)"
    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="transform opacity-0 scale-100"
    x-transition:enter-end="transform opacity-100 scale-100"
    class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg"
    :class="{ 'absolute inset-0 z-50 flex items-center justify-center': add_tasks }">
    <div x-show="add_tasks" @click.away="add_tasks = false"
      class="bg-white rounded-md w-full border border-gray-500 xl:w-1/2 opacity-100 items-center justify-center relative max-w-2xl">
      <div class="flex-grow bg-whtie border-b border-gray-400 p-5 rounded-t flex items-center">
        <div class="w-3/4 md:w-4/5 lg:w-5/6">
          <p class="font-bold text-base lg:text-2xl text-gray-800">
            Add tasks to your invoice
          </p>
          <p class="font-bold leading-tight text-base lg:text-lg text-blue-500">
            <%= @invoice.customer.name %> - #<%= @invoice.invoice_nbr %>
          </p>
        </div>
        <div class="w-1/4 md:w-1/5 lg:w-1/6 flex items-center"><%= image_tag('no_invoices.svg', alt: 'Builders')%>
        </div>
      </div>
      <div class="">
        <% tasks.each do |project, tasks| %>
          <div class="border-b">
            <div class="flex p-4 border-b border-gray-400 bg-gray-200">
              <div class="w-8">
                <%= check_box_tag(project, project, false, class: "text-green-500 mt-1 btn-bounce hover:scale-150") %>
              </div>
              <div class="text-xl font-bold text-gray-900 flex items-center">
                <%= project %>
              </div>
            </div>
            <div class="">
              <% tasks.each do |task| %>
                <div id="<%= dom_id(task) %>" class="w-full text-left">
                  <div class="w-full flex p-4">
                    <div class="flex flex-grow items-center">
                      <div class="w-8">
                        <%= check_box_tag(project, task, false, class: "text-green-500 mt-1 btn-bounce hover:scale-150") %>
                      </div>
                      <div class="w-1/3 lg:w-1/4 flex">
                        <p class="text-sm md:text-base"><%= task.title %></p>
                      </div>
                      <div class="w-1/3 lg:w-1/4">
                        <%= task_tag(task.status) %>
                      </div>
                      <div class="w-1/4 hidden lg:inline-block">
                        <%= task.hours %> h
                      </div>
                      <div class="w-1/3 lg:w-1/4 flex justify-center md:justify-start">
                        <%= l(task.created_at.to_date) %>
                      </div>
                      <div class="w-12 flex justify-center items-center">
                        <%= button_to(invoice_task_path(invoice, task), method: :patch, class: "text-green-500 mt-1 btn-bounce hover:scale-150", remote: true) do %>
                          <%= render("application/icons/plus_big") %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
        <div
          class="absolute top-0 right-0 bg-gray-900 hover:bg-gray-700 md:hover:bg-red-400 md:bg-red-600 w-5 h-5 md:w-8 md:h-8 rounded md:rounded-full text-white font-bold flex items-center justify-center mt-2 mr-2 md:-mt-4 md:-mr-4 cursor-pointer"
          @click="add_tasks = false">
          <svg class="h-3 w-3 md:h-5 md:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </div>
      </div>
      <div class="w-full flex py-5 px-5">
        <div class="w-full flex justify-end items-center">
          <div class="w-20 mr-2">
            <button
              @click="add_tasks = false"
              class="w-full text-blue-600 uppercase font-bold text-sm hover:text-blue-300"
            >
              Avbryt
            </button>
          </div>
          <div class="w-20">
            <%= button_to(invoice_task_path(invoice, tasks), method: :patch, class: "btn btn-blue btn-bounce", remote: true) do %>
              <% t('.submit')%>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
