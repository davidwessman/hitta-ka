<div x-data="{ add_tasks: false }">
  <% if tasks.any? %>
    <button @click="add_tasks = true" class="btn btn-orange">
      Add tasks <%= icon('fas', 'plus', class: "ml-2") %>
    </button>
  <% else %>
    <button disabled class="btn bg-gray-400">
      Add tasks <%= icon('fas', 'plus', class: "ml-2") %>
    </button>
  <% end %>
  <div id="invoice-tasks" x-show="add_tasks" class="overflow-y-auto bg-gray-900" style="background-color: rgba(0,0,0,0.5)"
    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="transform opacity-0 scale-100"
    x-transition:enter-end="transform opacity-100 scale-100"
    class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg"
    :class="{ 'absolute inset-0 z-50 flex items-center justify-center': add_tasks }">
    <div x-show="add_tasks" @click.away="add_tasks = false"
      class="bg-white rounded-md xl:w-1/2 opacity-100 items-center justify-center relative max-w-3xl">
      <div class="flex-grow h-12 bg-orange-600 px-3 py-2 rounded-t flex items-center">
        <h1 class="text-white font-semibold font-semibold text-xl xl:text-2xl">
          <%= t('.add_tasks') %>
        </h1>
      </div>
      <div class="px-4">
        <% tasks.each do |project, tasks| %>
          <div class="flex py-4 border-b-2 border-blue-500">
            <div class="text-xl text-gray-900">
              <%=t(".project") %>: <%= project %>
            </div>
          </div>
          <div class="">
            <% tasks.each do |task| %>
              <div id="<%= dom_id(task) %>" class="w-full text-left hover:bg-blue-200">
                <div class="w-full flex py-4">
                  <div class="flex flex-grow items-center">
                    <div class="w-1/3 lg:w-1/4">
                      <p class="text-sm md:text-base"><%= task.title %></p>
                    </div>
                    <div class="w-1/3 lg:w-1/4">
                      <%= task_tag(task.status) %>
                    </div>
                    <div class="w-1/4 hidden lg:inline-block">
                      <%= t('.hours', count: task.hours) %>
                    </div>
                    <div class="w-1/3 lg:w-1/4 flex justify-center md:justify-start">
                      <%= l(task.created_at.to_date) %>
                    </div>
                    <div class="w-12 flex justify-center items-center">
                      <%= button_to(invoice_task_path(invoice, task), method: :patch, class: "btn btn-orange", remote: true) do %>
                        <%= t(".add") %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
        <div
          class="absolute top-0 right-0 bg-red-600 w-8 h-8 rounded-full text-white font-bold flex items-center justify-center -mt-4 -mr-4 cursor-pointer"
          @click="add_tasks = false">
          <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </div>
      </div>
    </div>
  </div>
</div>
